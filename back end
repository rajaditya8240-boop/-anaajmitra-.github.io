from flask import Flask, render_template, request, jsonify
import json
import pickle

app = Flask(__name__)

# Load translations
with open("translations.json", "r", encoding="utf-8") as f:
    translations = json.load(f)

# Load AI model (optional, for simplicity we use rule-based here)
# model = pickle.load(open("models/crop_model.pkl", "rb"))

def predict_crop(season, soil, water):
    # Example simple logic, can replace with ML model
    if season == "Rabi" and soil == "Loamy" and water != "Low":
        return ["Wheat", "Mustard"]
    elif season == "Kharif" and soil == "Clay" and water == "High":
        return ["Rice", "Maize"]
    elif season == "Zaid" and soil == "Sandy":
        return ["Watermelon", "Muskmelon"]
    else:
        return ["Consult local expert"]

@app.route("/", methods=["GET", "POST"])
def index():
    if request.method == "POST":
        season = request.form.get("season")
        soil = request.form.get("soil")
        water = request.form.get("water")
        lang = request.form.get("language", "en")

        crops = predict_crop(season, soil, water)

        # Translate crops if language is not English
        if lang != "en":
            crops = [translations[lang].get(crop, crop) for crop in crops]

        return jsonify({"crops": crops})
    return render_template("index.html")
   

if __name__ == "__main__":
    app.run(debug=True)
